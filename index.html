<!DOCTYPE html>
<html lang="en">
<head>
	<title>Управление зависимостями в Python в 2017</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="node_modules/shower-ribbon/styles/screen-16x10.css">
	<link rel="icon" type="image/png" sizes="192x192"  href="http://igorshevchenko.ru/static/css/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="http://igorshevchenko.ru/static/css/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="http://igorshevchenko.ru/static/css/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="http://igorshevchenko.ru/static/css/icons/favicon-16x16.png">
	<style>
		.shower.list {
			background: url(style/texture.png); /* pattern from https://www.toptal.com/designers/subtlepatterns/seamless-paper-texture/ */
		}

		.slide {
			font-size: 35px;
			line-height: 1.75em;
		}

		.slide h2 {
			color: #000000;
		}

		.slide::after {
			visibility: hidden;
		}

		.slide pre.shell code::before {
			position: absolute;
			margin-left: -1em;
			color: #979a9e;
			content: "$";
		}

		.slide.no-top-padding {
			padding-top: 30px;
		}
	</style>
</head>
<body class="shower list">
    <!-- Yandex.Metrika counter --> <script type="text/javascript" > (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter46242456 = new Ya.Metrika({ id:46242456, clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true, trackHash:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks"); </script> <noscript><div><img src="https://mc.yandex.ru/watch/46242456" style="position:absolute; left:-9999px;" alt="" /></div></noscript> <!-- /Yandex.Metrika counter -->
	<header class="caption">
		<h1>Управление зависимостями в Python в 2017</h1>
		<p><a href="http://igorshevchenko.ru">Игорь Шевченко</a>, <a href="https://antidasoftware.com/">Antida software</a></p>
	</header>

	<section class="slide" id="cover">
		<div class="place bottom" id="title">
			<h2>Управление зависимостями в&nbsp;Python в&nbsp;2017</h2>
			<p>Игорь Шевченко, Antida software</p>
		</div>
		<img src="images/cover.svg" class="cover">
		<style>
			#title {
				width: 90%;
				margin-bottom: 20px;
			}
			#cover .cover {
				top: 40%;
			}
			#cover h2 {
				margin: 30px 0 0;
				text-align:center;
				font-size:70px;
				color: #000;
			}
			#cover p {
				margin:10px 0 0;
				text-align:center;
				font-style:italic;
				color: #000;
			}
		</style>
	</section>

	<section class="slide"><h2 class="shout">pip</h2></section>

	<section class="slide">
		<h2>pip</h2>
		<img src="images/stack.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide">
		<h2>pip: установка пакетов</h2>
		<pre class="shell">
			<code>pip install django</code>
			<code>pip install requests</code>
		</pre>
	</section>

	<section class="slide">
		<h2>pip: сохранение в файл</h2>
		<pre class="shell">
			<code>pip freeze > requirements.txt</code>
		</pre>
	</section>

	<section class="slide">
		<h2>requirements.txt</h2>
		<pre style="font-size: 25px;">
			<code>certifi==2017.7.27.1
chardet==3.0.4
Django==1.11.4
idna==2.6
pytz==2017.2
requests==2.18.4
urllib3==1.22</code>
		</pre>
	</section>

	<section class="slide">
		<h2>pip: установка из файла</h2>
		<pre class="shell">
			<code>pip install -r requirements.txt</code>
		</pre>
	</section>

	<section class="slide">
		<h2 class="shout">Проблемы</h2>
	</section>

	<section class="slide">
		<h2>Проблема 1: обновление файла</h2>
		<img src="images/logistics.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide">
		<h2>Проблема 1: npm</h2>
		<pre class="shell">
			<code>npm install jquery --save</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Проблема 1: решение</h2>
		<pre class="shell" style="font-size: 33px;">
			<code>pip install celery</code>
			<code>pip freeze | grep celery >> requirements.txt</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Проблема 2: глобальная установка пакетов</h2>
		<img src="images/storage.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide">
		<h2>Проблема 2: решение</h2>
		<p>virtualenv</p>
	</section>

	<section class="slide">
		<h2>Проблема 3: фиксирование версий</h2>
		<img src="images/lock.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide" style="font-size: 30px;">
		<h2>Проблема 3: все зависимости</h2>
		<pre>
			<code>certifi==2017.7.27.1
chardet==3.0.4
Django==1.11.4
idna==2.6
pytz==2017.2
requests==2.18.4
urllib3==1.22</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Проблема 3: основные зависимости</h2>
		<pre>
			<code>django==1.11
requests</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Проблема 3: решение</h2>
		<p>Два файла: requirements.txt и requirements.lock.txt</p>
	</section>

	<section class="slide">
		<h2>Проблема 4: dev-зависимости</h2>
		<img src="images/data-center.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide">
		<h2>Проблема 4: npm</h2>
		<pre class="shell">
			<code>npm install jquery --save</code>
			<code>npm install grunt --save-dev</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Проблема 4: npm</h2>
		<pre class="shell">
			<code>npm install</code>
			<code>npm install --production</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Проблема 4: решение</h2>
		<p>Два файла: requirements.txt и dev-requirements.txt</p>
	</section>

	<section class="slide">
		<h2>Проблема 4: dev-requirements.txt</h2>
		<pre><code><mark>-r requirements.txt</mark>
pytest==3.2.3</code></pre>
	</section>

	<section class="slide">
		<h2>Проблема 5: ад зависимостей</h2>
		<img src="images/falling.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide">
		<img src="images/hell.jpeg" class="cover">
	</section>

	<section class="slide">
		<h2>Проблема 5: решение</h2>
		<p>Всё сложно.</p>
		<p><a href="https://tech.knewton.com/blog/2015/09/the-nine-circles-of-python-dependency-hell/">https://tech.knewton.com/blog/2015/09/the-nine-circles-of-python-dependency-hell/</a></p>

	</section>

	<section class="slide">
		<h2>Проблема 6: тайпосквоттинг</h2>
		<img src="images/inspection.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide">
		<h2>Проблема 6: пример</h2>
		<pre class="shell">
			<code>pip install <mark class="important">djanngo</mark></code>
		</pre>
	</section>

	<section class="slide">
		<h2>Проблема 6: npm</h2>
		<p>Недавно был инцидент с пакетами, ворующими секретные токены</p>
		<p><a href="https://iamakulov.com/notes/npm-malicious-packages/">https://iamakulov.com/notes/npm-malicious-packages/</a></p>
	</section>

	<section class="slide">
		<h2>Проблема 6: решение</h2>
		<p><i>Хорошие ребята</i> сами занимают похожие имена</p>
		<p><a href="https://www.pytosquatting.org/">https://www.pytosquatting.org/</a></p>
	</section>

	<section class="slide">
		<h2 class="shout">2017</h2>
	</section>

	<section class="slide">
		<h2>Pipfile</h2>
		<p><a href="https://github.com/pypa/pipfile">https://github.com/pypa/pipfile</a></p>
	</section>

	<section class="slide">
		<h2>Pipfile: формат файла</h2>
		<pre style="font-size: 16px;"><code>[[source]]
url = 'https://pypi.python.org/simple'
verify_ssl = true

[requires]
python_version = '3.6'

[packages]
requests = { extras = ['socks'] }
Django = '>1.10'

[dev-packages]
pytest = '*'</code></pre>
	</section>

	<section class="slide no-top-padding">
		<pre style="font-size: 23px;"><code>[[source]]
url = 'https://pypi.python.org/simple'
verify_ssl = true

[requires]
python_version = '3.6'

[packages]
requests = { extras = ['socks'] }
Django = '>1.10'

[dev-packages]
pytest = '*'</code></pre>
	</section>

	<section class="slide">
		<h2>Pipfile: lock-файл</h2>
		<pre style="font-size: 10px;"><code>{
	"_meta": {
		"hash": {
			"sha256": "73d81f4fbe42d1da158c5d4435d9...",
		},
		"requires": [
			{"marker": "python_version", "specifier": "3.6"}
		],
		"sources": [
			{"url": "https://pypi.python.org/simple", "verify_ssl": true},
		]
		},
	"default": [
		{"name": "Django", "version": "1.10.3", "hash": "..."},
		{"name": "requests", "version": "2.12.1", "hash": "..."},
		{"name": "PySocks", "version": "1.5.6", "hash": "..."},
	],
	"development": [
		{"name": "pytest", "version": "3.2.3", "hash": "..."},
	]
}</code></pre>
	</section>

	<section class="slide no-top-padding">
		<pre style="font-size: 14px;"><code>{
	"_meta": {
		"hash": {
			"sha256": "73d81f4fbe42d1da158c5d4435d9...",
		},
		"requires": [
			{"marker": "python_version", "specifier": "3.6"}
		],
		"sources": [
			{"url": "https://pypi.python.org/simple", "verify_ssl": true},
		]
		},
	"default": [
		{"name": "Django", "version": "1.10.3", "hash": "..."},
		{"name": "requests", "version": "2.12.1", "hash": "..."},
		{"name": "PySocks", "version": "1.5.6", "hash": "..."},
	],
	"development": [
		{"name": "pytest", "version": "3.2.3", "hash": "..."},
	]
}</code></pre>
	</section>

	<section class="slide">
		<h2 class="shout">pipenv</h2>
	</section>

	<section class="slide">
		<h2>pipenv</h2>
		<p>pipenv = pip + Pipfile + virtualenv</p>
		<p><a href="https://github.com/kennethreitz/pipenv">https://github.com/kennethreitz/pipenv</a></p>
	</section>

	<section class="slide">
		<h2>pipenv: установка</h2>
		<pre class="shell"><code>pip install pipenv</code></pre>
	</section>

	<section class="slide">
		<h2>pipenv: старт проекта</h2>
		<pre class="shell">
			<code>cd my_project</code><code>pipenv install</code>
		</pre>
	</section>

	<section class="slide">
		<h2>pipenv: добавление пакета</h2>
		<pre class="shell"><code>pipenv install django</code><code>pipenv install pytest --dev</code></pre>
	</section>

	<section class="slide">
		<h2>pipenv: обновление лок-файла</h2>
		<pre class="shell"><code>pipenv lock</code></pre>
	</section>

	<section class="slide">
		<h2>pipenv: удаление пакета</h2>
		<pre class="shell"><code>pipenv uninstall django</code></pre>
	</section>

	<section class="slide">
		<h2>pipenv: восстановление среды</h2>
		<pre class="shell"><code>pipenv install</code></pre>
	</section>

	<section class="slide">
		<h2>pipenv: исполнение команд</h2>
		<pre class="shell">
			<code>pipenv shell</code>
			<code class="next">pipenv run python my_project.py</code>
		</pre>
	</section>

	<section class="slide">
		<h2>pipenv: обнаружение конфликтов версий</h2>
		<pre style="font-size: 30px"><code>[[source]]
url = "https://pypi.python.org/simple"
verify_ssl = true

[packages]
idna = "==2.7"
requests = "*"</code></pre>
	</section>

	<section class="slide">
		<h2>Проблемы решены</h2>
		<ul>
			<li>Обновление файла ✔</li>
			<li class="next">Глобальная установка пакетов ✔</li>
			<li class="next">Фиксирование версий ✔</li>
			<li class="next">Dev-зависимости ✔</li>
		</ul>
	</section>

	<section class="slide">
		<h2>pipenv: обнаружение конфликтов версий</h2>
		<pre class="shell" style="font-size: 19px;">
			<code>pipenv install
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
<mark>CRITICAL:pip.index:Could not find a version that satisfies the requirement
 idna==2.7</mark> (from versions: 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 2.0
 2.1, 2.2, 2.3, 2.4, 2.5, 2.6)
Warning: Your dependencies could not be resolved. You likely have a mismatch in
 your sub-dependencies. You can use $ pipenv install --skip-lock to bypass
 this mechanism, then run $ pipenv graph to inspect the situation.</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Проблемы решены</h2>
		<ul>
			<li>Обновление файла ✔</li>
			<li>Глобальная установка пакетов ✔</li>
			<li>Фиксирование версий ✔</li>
			<li>Dev-зависимости ✔</li>
			<li>Ад зависимостей ✔</li>
		</ul>
	</section>

	<section class="slide">
		<h2>pipenv: защита от тайпосквоттинга</h2>
		<pre class="shell">
			<code>pipenv install <mark class="important">djanngo</mark>
Did you mean <mark>django</mark>? [Y/n]:
			</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Проблемы решены</h2>
		<ul>
			<li>Обновление файла ✔</li>
			<li>Глобальная установка пакетов ✔</li>
			<li>Фиксирование версий ✔</li>
			<li>Dev-зависимости ✔</li>
			<li>Ад зависимостей ✔</li>
			<li>Тайпосквоттинг ✔</li>
		</ul>
	</section>

	<section class="slide">
		<h2 class="shout">Дополнительные фичи</h2>
	</section>

	<section class="slide">
		<h2>Безопасность: проверка хешей</h2>
		<img src="images/security.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide">
		<h2>Безопасность: оповещение об уязвимостях</h2>
		<img src="images/dog.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide">
		<h2>Условная установка</h2>
		<pre style="font-size: 26px"><code>[[source]]
url = "https://pypi.python.org/simple"
verify_ssl = true

[packages]
requests = "*"
pywinusb = {version = "*", <mark>os_name = "== 'windows'"</mark>}</code></pre>
	</section>

	<section class="slide">
		<h2>Условная установка</h2>
		<pre style="font-size: 14px"><code>[[source]]
url = "https://pypi.python.org/simple"
verify_ssl = true
name = "pypi"

[packages]
unittest2 = {version = ">=1.0,<3.0",
             <mark>markers="python_version < '2.7.9' or (python_version >= '3.0' and python_version < '3.4')"</mark>}
</code></pre>
	</section>

	<section class="slide">
		<h2>Открытие модулей</h2>
		<pre class="shell" style="font-size: 26px"><code>pipenv open requests
<mark>Opening 'C:\\Users\\igor\\.virtualenvs\\pipenv-I9XgK3SA
 \\lib\\site-packages\\requests' in your EDITOR.</mark></code></pre>
	</section>

	<section class="slide">
		<h2>Еще фичи</h2>
		<ul>
			<li>Установка питона нужной версии через pyenv</li>
			<li>Загрузка переменных среды из файла</li>
			<li>Проверка стиля кода</li>
			<li>Генерация requirements.txt из Pipfile</li>
			<li>Работа без virtualenv</li>
			<li>Визуализация дерева зависимостей</li>
			<li>Обнаружение неиспользуемых зависимостей</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Переходите на pipenv!</h2>
		<img src="images/forklift.svg" height="450" class="cover place bottom">
	</section>

	<section class="slide">
		<h2>Вопросы?</h2>
		<div class="at-bottom">
			<p>
				Слайды: <a href="https://igor-shevchenko.github.io/python-deps-2017">https://igor-shevchenko.github.io/python-deps-2017</a>
				<br>
				Почта: <a href="mailto:mail@igorshevchenko.ru">mail@igorshevchenko.ru</a>
				<br>
				Твиттер: <a href="https://twitter.com/igorshevchenko_" class="low-underline">@igorshevchenko_</a>
			</p>
		</div>
		<style>
			.low-underline {
				padding-bottom: 5px;
			}
			.at-bottom {
				position: absolute;
				bottom: 0;
			}
		</style>
	</section>

	<section class="slide">
		<h2>Спасибо автору картинок</h2>
		<img src="images/artist.svg" height="450" class="cover place bottom">
		<p class="note place left bottom" id="credits">Created by <a href="https://thenounproject.com/leremy">Gan Khoon Lay</a> from <a href="https://thenounproject.com">the Noun Project</a></p>
		<style>
			#credits {
				margin-left: 100px;
			}
			#credits a {
				color: #979a9e;
			}
		</style>
	</section>

	<script src="node_modules/shower-core/shower.min.js"></script>

</body>
</html>
